@startuml

!function $resource($alias,$path) !return "class " + $alias + "<<(R,LimeGreen) "+"/api/v1/"+$path+">>" + "#LightGreen"
!function $seperator($text) !return "=="+"<U+0020>"+$text+"<U+0020>"+"=="

!$req_res_pipeline="#line:293A47;text:Black : <color DarkGreen> req <color 293A47>/<color Indigo> res "
!$req_line="#line:DarkGreen;text:DarkGreen : req"
!$res_line="#line:Indigo;text:Indigo : res"

title =API Structure

legend top right

|= Color    |= Abbreviation |= Details |
| <#008000> |   req         | Client Request Object\n - Payload expected in req.body  |
| <#4b0082> |   res         | Server Response Object\n - JSON format|

|= Indicator |= Access         |
| ğŸ”’         | Admin Only      |
| ğŸ”‘         | Authorized Only |
| ğŸŒ         | Open            |

endlegend

together {  

  class Root << (A,LightYellow) API >> #LightYellow {
    $seperator("Meta")
    version: 0.0.0
    path: domain.ext/api/v1
    --
    ==<color 293A47>processRequest
  }

  circle api/v1 #Black

  class Response << (R, Orchid) JSON>> #Pink {
    format: JSON
    --
    status: Number
    message: String
    errors: [] | [String]
    body: Object
  }
}

together {
  $resource(Users,"users") {
    =$seperator("Endpoints")
    ==$seperator("/")
      â”œâ”€ğŸ”’ GET 
      â””â”€ğŸ”‘ POST

    ==$seperator("/{userId}")
      â”œâ”€ğŸ”‘ GET
      â”œâ”€ğŸ”‘ DELETE 
      â””â”€ğŸ”‘ PUT
    
    ==$seperator("/{userId}/keys")
       â””â”€ğŸ”‘ GET

    ==$seperator("/{userId}/posts")
       â””â”€ğŸ”‘ GET

    ==$seperator("/{userId}/comments")
       â””â”€ğŸ”‘ GET
  }
  $resource(APIKeys,"keys") {
    =$seperator("Endpoints")
    ==$seperator("/")
      â”œâ”€ğŸ”’ GET 
      â””â”€ğŸ”‘ POST

    ==$seperator("/{keyId}")
      â”œâ”€ğŸ”’ DELETE 
      â””â”€ğŸ”’ PUT
  }
  $resource(Profiles,"profiles"){
    =$seperator("Endpoints")
    ==$seperator("/")
      â””â”€ğŸ”‘ GET

    ==$seperator("/{username}")
      â”œâ”€ğŸ”‘ GET
      â”œâ”€ğŸ”‘ PUT
      â””â”€ğŸ”‘ DELETE

    ==$seperator("/{username}/public")
       â””â”€ğŸŒ|ğŸ”‘ GET
  }

  $resource(Blogs,"blogs") {
    =$seperator("Endpoints")
    ==$seperator("/")
      â”œâ”€ğŸŒ GET 
      â””â”€ğŸ”‘ POST

    ==$seperator("/{blogId}")
      â”œâ”€ğŸŒ GET
      â”œâ”€ğŸ”‘ DELETE 
      â””â”€ğŸ”‘ PUT

    ==$seperator("/{blogId}/posts")
       â””â”€ğŸŒ GET 
  }

  $resource(Posts,"posts") {
    =$seperator("Endpoints")
    ==$seperator("/")
      â”œâ”€ğŸŒ GET 
      â””â”€ğŸ”‘ POST

    ==$seperator("/{postId}")
      â”œâ”€ğŸŒ GET
      â”œâ”€ğŸ”‘ DELETE 
      â””â”€ğŸ”‘ PUT

    ==$seperator("/{postId}/comments")
       â””â”€ğŸŒ GET

    ==$seperator("/{postId}/reactions")
       â””â”€ğŸŒ GET
  }

  $resource(Comments,"comments") {
    =$seperator("Endpoints")
    ==$seperator("/")
      â”œâ”€ğŸ”’ GET 
      â””â”€ğŸ”‘ POST
    
    ==$seperator("/{commentId}")
      â”œâ”€ğŸ”‘ DELETE 
      â””â”€ğŸ”‘ PUT

    ==$seperator("/{commentId}/replies")
       â””â”€ğŸŒ GET

    ==$seperator("/{commentId}/reactions")
       â””â”€ğŸŒ GET
  }

  $resource(Reactions,"reactions") {
    =$seperator("Endpoints")
    ==$seperator("/")
      â”œâ”€ğŸ”’ GET 
      â””â”€ğŸ”‘ POST

    ==$seperator("/{reactionId}")
      â”œâ”€ğŸ”‘ DELETE 
      â””â”€ğŸ”‘ PUT
  }

    $resource(Roles,"roles") {
    =$seperator("Endpoints")
    ==$seperator("/")
      â”œâ”€ğŸ”’ GET 
      â””â”€ğŸ”’ POST

    ==$seperator("/{roleId}")
      â”œâ”€ğŸ”’ GET
      â”œâ”€ğŸ”’ DELETE 
      â””â”€ğŸ”’ PUT
  }
}

"api/v1" --> Root::processRequest $req_line
Root::processRequest --> Response $res_line
Response -> "api/v1" $res_line

"api/v1" <--> Users $req_res_pipeline
"api/v1" <--> APIKeys $req_res_pipeline
"api/v1" <--> Profiles $req_res_pipeline
"api/v1" <--> Blogs $req_res_pipeline
"api/v1" <--> Posts $req_res_pipeline
"api/v1" <--> Comments $req_res_pipeline
"api/v1" <--> Reactions $req_res_pipeline

note bottom of Root
  - Routes the request to the corresponding controller.
  - Controller routes the result to the response formatter.
  - Response formatter sends the response to the client

If an error is encountered at any point, 
execution halts and a response containing
the errors in an array is sent to the client.
endnote


@enduml